# SupportZen Client API Documentation

This document specifies the APIs for the live chat and ticketing services, designed to be implemented on the **SupportZen backend**. The client application will interact with these endpoints to provide support to authenticated users.

## Authentication

All requests to the Client API must be authenticated using a Bearer token sent in the `Authorization` header.

The token is **not** a simple API key. Instead, it is a **HMAC-SHA256 hash** generated by the client to verify the user's identity without exposing sensitive information like their secret authentication token.

-   **Method**: `HMAC-SHA256`
-   **Message**: The user's `email` address.
-   **Secret Key**: The user's secret `auth_token`.
-   **Format**: The resulting hexadecimal hash string.

The client will generate this hash and send it with every request.

**Example Header:**
`Authorization: Bearer <HMAC-SHA256-hash>`

The SupportZen backend must re-calculate this hash using the `email` from the request body and the corresponding `auth_token` it has stored for that user to verify the request's authenticity. If a user does not exist, the server will create one and trust the first request.

---

## Live Chat API

### 1. Create a New Live Chat Session

This endpoint initiates a new chat session. It should be called only when the user sends their first message in a new conversation.

-   **Endpoint:** `POST /api/client/live/create`
-   **Authentication:** Required (HMAC Bearer Token).

#### Request Payload

| Field | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| `email` | string | Yes | The user's email address. Used for identification and HMAC validation. |
| `name` | string | No | The user's name or current plan name (e.g., "Basic Plan"). |
| `plan_id` | number | No | The user's current subscription plan ID. |
| `created_at` | number | Yes | The user's account creation timestamp. |
| `message` | string | Yes | The initial message content from the user. |
| `image_url` | string | No | An optional URL to an image to be attached. |

#### Success Response

```json
{
  "status": "success",
  "message": "Live chat session created successfully.",
  "data": {
    "chatId": "chat-session-xyz-123"
  },
  "error": null
}
```

---

### 2. Send a Message to an Existing Chat

This endpoint is used to send all subsequent messages after a chat session has been created.

-   **Endpoint:** `POST /api/client/live/chat`
-   **Authentication:** Required (HMAC Bearer Token).

#### Request Payload

| Field | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| `chat_id` | string | Yes | The ID of the active chat session (obtained from the `/create` endpoint). |
| `email` | string | Yes | The user's email, used for HMAC verification. |
| `message` | string | Yes | The content of the chat message. |
| `image_url`| string | No | An optional URL to an image to be attached. |

#### Success Response

```json
{
  "status": "success",
  "message": "Message sent successfully.",
  "data": {
    "chatId": "chat-session-xyz-123",
    "messageId": "msg-abc-456"
  },
  "error": null
}
```

---

## Ticket API

### 1. Create a New Support Ticket

This endpoint creates a new support ticket.

-   **Endpoint:** `POST /api/client/ticket/create`
-   **Authentication:** Required (HMAC Bearer Token).

#### Request Payload
The payload is identical to creating a new chat session.

| Field | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| `email` | string | Yes | The user's email address. Used for identification and HMAC validation. |
| `name` | string | No | The user's name or current plan name (e.g., "Basic Plan"). |
| `plan_id` | number | No | The user's current subscription plan ID. |
| `created_at` | number | Yes | The user's account creation timestamp. |
| `message` | string | Yes | The initial message/subject of the ticket. |
| `image_url` | string | No | An optional URL to an image to be attached. |

#### Success Response

```json
{
  "status": "success",
  "message": "Ticket created successfully.",
  "data": {
    "ticketId": "TKT-001"
  },
  "error": null
}
```

---

### 2. Append a Message to a Ticket

This endpoint adds a new message from the customer to an existing ticket.

-   **Endpoint:** `POST /api/client/ticket/append`
-   **Authentication:** Required (HMAC Bearer Token).

#### Request Payload

| Field | Type | Required | Description |
| :--- | :--- | :--- | :--- |
| `ticket_id` | string | Yes | The ID of the ticket to append the message to. |
| `email` | string | Yes | The user's email, used for HMAC verification. |
| `message` | string | Yes | The content of the message. |
| `image_url`| string | No | An optional URL to an image to be attached. |

#### Success Response

```json
{
  "status": "success",
  "message": "Message appended to ticket successfully.",
  "data": {
    "ticketId": "TKT-001",
    "messageId": "msg-def-789"
  },
  "error": null
}
```
